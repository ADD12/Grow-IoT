{"version":3,"file":"Thing.umd.js","sources":["../lib/thing.js"],"sourcesContent":["const _ = require('underscore');\nconst later = require('later');\nconst EventEmitter = require('events');\n\nclass Thing extends EventEmitter {\n  /**\n   * Constructs a new thing object.\n   * @param {Object} config\n   * @return     A new thing object\n  */\n  constructor(config) {\n    super();\n\n    if (!config) {\n      throw new Error('Thing.js requires an config object.');\n    } else {\n      _.extend(this, config);\n    }\n\n    // Register actions events\n    this.registerActions();\n    this.registerEvents();\n  }\n\n  /**\n   * Registers actions and starts any scheduled actions.\n   */\n  registerActions () {\n    this.scheduledActions = [];\n\n    for (var action in this.actions) {\n      var actionId = this.actions[action].id;\n      var action = this.getActionByID(actionId);\n      if (!_.isUndefined(action)) {\n        this.startAction(actionId);\n      }\n    }\n  }\n\n  /**\n   * Register a events and setup listeners.\n   */\n  registerEvents () {\n    this.scheduledEvents = [];\n\n    // Check top level thing model for events.\n\n    // TODO: don't do this with a for loop. Just check this.events.\n    for (var key in this) {\n      if (key === 'events') {\n        for (var event in this[key]) {\n          event = this[key][event];\n          this.on(event.on, () => {\n            event.function();\n          });\n        }\n      }\n    }\n\n    for (var event in this.events) {\n      var eventId = this.events[event].id;\n      // this is silly, because it's called both here and in startEvent...\n      var event = this.getEventByID(eventId);\n      if (!_.isUndefined(event)) {\n        this.startEvent(eventId);\n      }\n    }\n  }\n\n  /**\n   * Get action object based on the action id\n   * @param {String} actionId  The id of the action object you want.\n   * @returns {Object}\n   */\n  getActionByID (actionId) {\n    // Todo, check to make sure actions ex\n\n    for (var i = this.actions.length - 1; i >= 0; i--) {\n      if (this.actions[i].id === actionId) {\n        return this.actions[i];\n      }\n    }\n  }\n\n  /**\n   * Calls a registered action, emits event if the the action has an 'event'\n   * property defined. Updates the state if the action has an 'updateState'\n   * property specified.\n   * @param      {String}  actionId The id of the action to call.\n   * @param      {Object}  options Optional, options to call with the function.\n  */\n  callAction (actionId, options) {\n    var action = this.getActionByID(actionId);\n\n    this.emit(actionId)\n\n    if (!_.isUndefined(options)) {\n      return action.function(options);\n    }\n    else {\n      return action.function();\n    }\n  }\n\n  /**\n   * Starts a reoccurring action if a schedule property is defined.\n   * @param {Object} action An action object.\n   */\n  startAction (action) {\n    // do we need to make the redundent call to getActionByID?\n    var meta = this.getActionByID(action);\n    if (!_.isUndefined(meta.schedule)) {\n      var schedule = later.parse.text(meta.schedule);\n      var scheduledAction = later.setInterval(()=> {this.callAction(action);}, schedule);\n      this.scheduledActions.push(scheduledAction);\n      return scheduledAction;\n    }\n  }\n\n  /**\n   * Get event object based on the event id\n   * @param {String} eventId  The id of the event object you want.\n   * @returns {Object}\n   */\n  getEventByID (eventId) {\n    for (var i = this.events.length - 1; i >= 0; i--) {\n      if (this.events[i].id === eventId) {\n        return this.events[i];\n      }\n    }\n  }\n\n\n  // This was a hack... delete?\n  /**\n   * Calls a registered event function.\n   * @param      {String}  eventId The id of the event to call.\n   * @param      {Object}  options Optional, options to call with the function.\n  */\n  callEvent (eventId, options) {\n    var event = this.getEventByID(eventId);\n\n    this.emit(eventId);\n\n    if (!_.isUndefined(options)) {\n      return event.function(options);\n    }\n    else {\n      return event.function();\n    }\n  }\n\n  /**\n   * Starts a reoccurring event if a schedule property is defined.\n   * @param {Object} event An event object.\n   */\n  startEvent (event) {\n    var meta = this.getEventByID(event);\n    if (!_.isUndefined(meta.schedule)) {\n      var schedule = later.parse.text(meta.schedule);\n      var scheduledEvent = later.setInterval(()=> {this.callEvent(event);}, schedule);\n      this.scheduledEvents.push(scheduledEvent);\n      return scheduledEvent;\n    }\n  }\n};\n\nexport default Thing;\n"],"names":[],"mappings":"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"}